<!DOCTYPE html>
<html>

<head>
  <script src="https://maps.googleapis.com/maps/api/js"></script>
  <script src="//d3js.org/d3.v3.min.js"></script>
  <script src="//d3js.org/topojson.v1.min.js"></script>

  <style>
    #map {
      height: 800px;
      width: 100%;
    }
  </style>

</head>

<body>
  <div id="map"></div>
  <script>
    var map = new google.maps.Map(d3.select("#map").node(), {
      zoom: 8,
      center: new google.maps.LatLng(43.469740, 10.946157),
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      styles: [{
        "stylers": [{
          "saturation": -50
        }, {
          "lightness": 30
        }]
      }]
    });

    d3.json("https://jsonblob.com/api/1e7c9245-e4b6-11e6-90ab-914a66f2a924", function(error, data) {
      if (error) throw error

      //console.log(data[0].comuni[0].geometry.coordinates);
      var overlay = new google.maps.OverlayView();

      overlay.onAdd = function() {

        var layer = d3.select(this.getPanes().overlayLayer).append("div")

        overlay.draw = function() {

          layer.select('svg').remove();

          var w = 900;
          var h = 600;

          var color = ['#e41a1c', '#377eb8', '#4daf4a', '#984ea3', '#ff7f00', '#ffff33', '#a65628', '#f781bf', '#999999'];
          var heat_color = d3.scale.linear().domain([0, 1]).range(['#b2df8a', '#ff7f00']).interpolate(d3.interpolateHcl);
          
          var overlayProjection = this.getProjection();
          
          // Turn the overlay projection into a d3 projection
          var googleMapProjection = function(coordinates) {
            var googleCoordinates = new google.maps.LatLng(coordinates[1], coordinates[0]);
            var pixelCoordinates = overlayProjection.fromLatLngToDivPixel(googleCoordinates);
            return [pixelCoordinates.x, pixelCoordinates.y];
          }

          var path = d3.geo.path().projection(googleMapProjection);

          var svg = layer.append("svg")
            .attr('width', w)
            .attr('height', h)

          var g = svg.selectAll("g")
            .data(data)
            .enter()
            .append("g");

          g.selectAll("path")
            .data(function(d) {
              return d.comuni;
            })
            .enter()
            .append("path")
            .attr("d", path)
            .attr('class', 'state selected')
            .style("fill", function(d, i) {
              return color[i % color.length];
            })
            .style('opacity', .7);
                     
        }
      }
      overlay.setMap(map);

    });
  </script>
  
 // THIS IS THE MARKER SCRIPT SECTION    
 <script>
   var marks = [{long: 15.029296875, lat: 12.039320557540572}, {long: -75, lat: 43}];
   svg.selectAll(".mark")
       .data(marks)
       .enter()
       .append("svg:image")
       .attr("class", "mark")
       .attr("width", 20)
       .attr("height", 20)
       .attr("xlink:href", )
       .attr("transform", d => 
   
   {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {},
      "geometry": {
        "type": "Point",
        "coordinates": [
          15.029296875,
          12.039320557540572
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {},
      "geometry": {
        "type": "Point",
        "coordinates": [
          8.61328125,
          12.12526421833159
        ]
      }
    }
  ]
}
   
  </script>
</body>
<!--!DOCTYPE html>
	<meta charset="utf-8">
	<title> Map Testingg <title>
<style>
.background{
	fill:none;
}
</style>
<body>
	
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://d3js.org/d3-color.v1.min.js"></script>
<script src="https://d3js.org/d3-dispatch.v1.min.js"></script>
<script src="https://d3js.org/d3-ease.v1.min.js"></script>
<script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
<script src="https://d3js.org/d3-selection.v1.min.js"></script>
<script src="https://d3js.org/d3-timer.v1.min.js"></script>
<script src="https://d3js.org/d3-transition.v1.min.js"></script>
<script src="https://d3js.org/d3-drag.v1.min.js"></script>
<script src="https://d3js.org/d3-zoom.v1.min.js"></script>
</script>

var topology = topojson.topology({foo: geojson});
var zoom = d3.zoom();
var width = 700;
    height = 600;
    activeWidth = width * 0.7; 
    activeHeight = height * 0.8;
    active = d3.select(null);

var svg = d3.select("body").append("svg").attr("width", width).attr("height", height);

var g = svg.append("g");

var projection = d3.geo.mercator()
    .center([0, 5 ])
    .scale(200)
    .rotate([-180,0]);

var path = d3.geo.path()
   .projection(projection);

var tip = d3.tip()
    .attr("class", "d3-tip")
    .offset([0,0])
    .html(function(d)) {
          return "<strong>Frequency:</strong> <span style='color:white'>" + d.count + </span>" = "<br/>" + d.country;

// load and display the World
d3.json("docs/world.topojson", function(error, topology){
  svg.call(tip)
if (error) return console.error(error);

// load and display the cities
d3.csv("docs/cities.csv", function(error, data){
  max = d3.max(data, function(d))
  {return +d.counter})
  coloring = d3.scale.linear()
    .domain([0,max])
    .range([2,30])
   
  g.selectAll("circle").data(data).enter().append("circle").on("mouseover", tip.show).on("mouseout", tip.hide).attr("cx", function(d) {
  return projection([d.lon, d.lat])[0];
  }).attr("cy", function(d) {
               return projection([d.lon, d.lat])[1];
       })
       .style("fill", function(d){
          return coloring(+d.counter);})
       .style("r",0)
       .transition()
       .duration(500)
       .delay(function(d, i) {return i*200;})
       .style("r",30);
});

g.selectAll("circle").data(topojson.object(topology, topology.objects.countries).geometries().enter().append("path").attr("d", path)
});

// zoom and pan

svg.call(zoom)

</script>
</body>
</html>
